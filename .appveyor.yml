image:
  - Visual Studio 2017

# branches to build
branches:
  only:
    - master

# environments
environment:
  matrix:
    - ARCH: Win64
      TOOLSET: msbuild
      CONFIGURATION: Release
    - ARCH: Win32
      TOOLSET: msbuild
      CONFIGURATION: Release
# clone directory
clone_folder: c:\projects\sqlite3enc

before_build:
  # set environment variables for SQLite3Enc
  - set LIBICU_PATH=C:\ICU_DATA
  - ps: Start-FileDownload  'https://github.com/unicode-org/icu/releases/download/release-64-2/icu4c-64_2-data.zip'
  - ps: Start-FileDownload 'https://github.com/unicode-org/icu/releases/download/release-64-2/icu4c-64_2-Win64-MSVC2017.zip'
  - cmd: 7z x -y icu4c-64_2-Win64-MSVC2017.zip -o%LIBICU_PATH%
  - cmd: 7z x icu4c-64_2-data.zip -o%LIBICU_PATH%
  - cmd: c:\projects\sqlite3enc\premake.bat --builddir=build vs2017

# build script
build_script:
  - cmd: c:\projects\sqlite3enc\admin\appveyor\appveyor.bat

after_build:
  - cmd: ls c:\projects\sqlite3enc
#  - cmd: 7z a -tzip SQLite3-Encryption_%platform%-v%APPVEYOR_BUILD_VERSION%.zip bin/ -xr@x_fn.txt
#  - ps: Get-ChildItem .\*.zip | % { Push-AppveyorArtifact $_.FullName -FileName $_.Name }
#
#deploy:
#   release: SQLite3-Encryption-v%APPVEYOR_BUILD_VERSION%
#   description: "update sqlite3 to v3.29.0"
#   provider: GitHub
#   auth_token:
#    secure: YiRkHuWnabCRwdYGhwkPZRSUJmVb/UeKn3YEQ+0mLTfIsGKrVUfDKdObe/MsYf1A
#   draft: false
#   prerelease: false
#   on:
#      branch: master
#   appveyor_repo_tag: false

on_success:
- ps: >-
    if ($true)

    {
      Write-Host "Success"
    }
