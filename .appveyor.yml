image:
  - Visual Studio 2015

# branches to build
branches:
  only:
    - master

# environments
environment:
  matrix:
    - COMPILER: "gcc"
      HOST:     "mingw"
      PLATFORM: "x64"
      TOOLSET: mingw64
      CONFIGURATIONS: "release_win64"

# clone directory
clone_folder: c:\projects\sqlite3enc

install:
  - ECHO Installing %COMPILER% %PLATFORM% %CONFIGURATION%
  - if [%COMPILER%]==[gcc] SET PATH_ORIGINAL=%PATH%
  - if [%COMPILER%]==[gcc] (
      SET "PATH_MINGW64=C:\mingw-w64\x86_64-7.3.0-posix-seh-rt_v5-rev0\mingw64\bin"
    )

before_build:
  # set environment variables for SQLite3Enc
  - set LIBICU_PATH=C:\ICU_DATA
  - ps: Start-FileDownload  'https://github.com/unicode-org/icu/releases/download/release-64-2/icu4c-64_2-data.zip'
  - ps: Start-FileDownload 'https://github.com/unicode-org/icu/releases/download/release-64-2/icu4c-64_2-Win64-MSVC2017.zip'
  - cmd: 7z x -y icu4c-64_2-Win64-MSVC2017.zip -o%LIBICU_PATH%
  - cmd: 7z x icu4c-64_2-data.zip -o%LIBICU_PATH%
  - cmd: c:\projects\sqlite3enc\premake.bat --builddir=build --cc=gcc gmake2

# build script
build_script:
  - if [%PLATFORM%]==[x64] SET PATH=%PATH_MINGW64%;%PATH_ORIGINAL%
  - cmd: c:\projects\sqlite3enc\admin\appveyor\appveyor.bat

after_build:
  - cmd: ls c:\projects\sqlite3enc
#  - cmd: 7z a -tzip SQLite3-Encryption_%platform%-v%APPVEYOR_BUILD_VERSION%.zip bin/ -xr@x_fn.txt
#  - ps: Get-ChildItem .\*.zip | % { Push-AppveyorArtifact $_.FullName -FileName $_.Name }
#
#deploy:
#   release: SQLite3-Encryption-v%APPVEYOR_BUILD_VERSION%
#   description: "update sqlite3 to v3.29.0"
#   provider: GitHub
#   auth_token:
#    secure: YiRkHuWnabCRwdYGhwkPZRSUJmVb/UeKn3YEQ+0mLTfIsGKrVUfDKdObe/MsYf1A
#   draft: false
#   prerelease: false
#   on:
#      branch: master
#   appveyor_repo_tag: false

on_success:
- ps: >-
    if ($true)

    {
      Write-Host "Success"
    }
